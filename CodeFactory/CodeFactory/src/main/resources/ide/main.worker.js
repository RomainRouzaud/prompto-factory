!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=33)}([function(t,e,r){"use strict";(function(t){r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return s})),r.d(e,"f",(function(){return i})),r.d(e,"e",(function(){return a})),r.d(e,"d",(function(){return c})),r.d(e,"a",(function(){return l}));var n=t||self||void 0,o=function(t,e,r){var o=new(0,n.prompto.parser[e+"CleverParser"])(t);return o.removeErrorListeners(),r&&o.addErrorListener(r),o},s=function(t,e,r){return o(t,e,r).parse()},i=function(t,e,r){var o=n.prompto,s=o.parser.Dialect[r],i=new o.utils.CodeWriter(s,t.newChildContext());return i.context.problemListener=new o.problem.ProblemCollector,e.comments&&e.comments.forEach((function(t){t.toDialect(i)})),e.annotations&&e.annotations.forEach((function(t){t.toDialect(i)})),e.toDialect(i),i.toString()},a=function(t,e,r,o){var i=n.prompto,a=s(e,r),c=i.parser.Dialect[o],l=new i.utils.CodeWriter(c,t.newChildContext());return a.toDialect(l),l.toString()},c=function(t,e){return t.sort((function(t,r){return t[e]>r[e]?1:t[e]<r[e]?-1:0}))},l=function(t){if(!t)return 0;var e=0;for(var r in t)Array.isArray(t[r])&&(e+=t[r].length);return e}}).call(this,r(4))},function(t,e,r){"use strict";var n=r(6),o=Object.prototype.toString;function s(t){return"[object Array]"===o.call(t)}function i(t){return void 0===t}function a(t){return null!==t&&"object"==typeof t}function c(t){if("[object Object]"!==o.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function l(t){return"[object Function]"===o.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),s(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.call(null,t[o],o,t)}t.exports={isArray:s,isArrayBuffer:function(t){return"[object ArrayBuffer]"===o.call(t)},isBuffer:function(t){return null!==t&&!i(t)&&null!==t.constructor&&!i(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isPlainObject:c,isUndefined:i,isDate:function(t){return"[object Date]"===o.call(t)},isFile:function(t){return"[object File]"===o.call(t)},isBlob:function(t){return"[object Blob]"===o.call(t)},isFunction:l,isStream:function(t){return a(t)&&l(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function t(){var e={};function r(r,n){c(e[n])&&c(r)?e[n]=t(e[n],r):c(r)?e[n]=t({},r):s(r)?e[n]=r.slice():e[n]=r}for(var n=0,o=arguments.length;n<o;n++)u(arguments[n],r);return e},extend:function(t,e,r){return u(e,(function(e,o){t[o]=r&&"function"==typeof e?n(e,r):e})),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return s}));var n=r(0),o=null;class s{constructor(e,r,n){!function(){var e=t||window||self||this;o=e.prompto}(),this.readCatalog(r,e),n&&this.filterOutDeclarations(n)}length(){return Object(n.a)(this)}readCatalog(t,e){var r=this.loadCatalog(t,e);this.attributes=r.attributes,this.categories=r.categories,this.enumerations=r.enumerations,this.methods=r.methods,this.tests=r.tests,this.widgets=r.widgets}loadCatalog(t,e){if(o&&e){var r=o.runtime.Context.newGlobalsContext();return r.problemListener=new o.problem.ProblemCollector,e.register(r),r.globals=t,r.getLocalCatalog()}return{}}filterOutDeclarations(t){this.filterOutObjects("attributes",t),this.filterOutMethods(t),this.filterOutObjects("categories",t),this.filterOutObjects("enumerations",t),this.filterOutObjects("tests",t),this.filterOutObjects("widgets",t)}filterOutObjects(t,e){this[t]&&(this[t]=this[t].filter((t=>null===e.contextForDeclaration(t))))}filterOutMethods(t){this.methods&&(this.methods=this.methods.filter((e=>this.filterOutMethod(e,t))))}filterOutMethod(t,e){if(null===e.contextForDeclaration(t.name))return!0;if(1===t.protos.length)return!1;var r=e.getRegisteredDeclaration(t.name);return t.protos=t.protos.filter((t=>!r.hasPrototype(t.proto))),t.protos.length>0}}}).call(this,r(4))},function(t,e,r){t.exports=r(16)},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(0),o=r(2);class s{constructor(){this.removed=null,this.added=null}length(){var t=0;return this.removed&&(t+=this.removed.length()),this.added&&(t+=this.added.length()),t}getContent(){return{removed:this.removed,added:this.added}}filterOutDuplicates(){if(!this.removed&&!this.added)return 0;if(!this.removed)return this.added.length();if(!this.added)return this.removed.length();var t=this.filterOutDuplicatesInField("attributes");return t+=this.filterOutDuplicatesInField("methods"),t+=this.filterOutDuplicatesInField("categories"),t+=this.filterOutDuplicatesInField("enumerations"),t+=this.filterOutDuplicatesInField("tests"),t+=this.filterOutDuplicatesInField("widgets")}filterOutDuplicatesInField(t){var e=this.filterOutDuplicatesInLists;"methods"===t?e=this.filterOutDuplicatesInMethods:"enumerations"===t&&(e=(t,e)=>this.filterOutDuplicatesInLists(t,e,"name"));var r=e.bind(this)(this.removed[t],this.added[t]);return this.removed[t]&&!this.removed[t].length&&delete this.removed[t],this.added[t]&&!this.added[t].length&&delete this.added[t],r}filterOutDuplicatesInLists(t,e,r){if(t&&e){r?(Object(n.d)(t,r),Object(n.d)(e,r)):(t.sort(),e.sort());for(var o=0,s=0;o<t.length&&s<e.length;){var i=t[o];r&&(i=i[r]);var a=e[s];r&&(a=a[r]),i===a?(t.splice(o,1),e.splice(s,1)):i>a?s++:o++}return t.length+e.length}return t?t.length:e?e.length:0}filterOutDuplicatesInMethods(t,e){if(t&&e){Object(n.d)(t,"name"),Object(n.d)(e,"name");for(var r=0,o=0;r<t.length&&o<e.length;)t[r].name===e[o].name?(this.filterOutDuplicatesInLists(t[r].protos,e[o].protos,"proto"),t[r].protos&&t[r].protos.length||t.splice(r,1),r++,e[o].protos&&e[o].protos.length||e.splice(o,1),o++):t[r].name>e[o].name?o++:r++;return t.length+e.length}return t?t.length:e?e.length:0}adjustForMovingProtos(t){this.removed&&this.removed.methods&&this.removed.methods.forEach((e=>{var r=t.getRegisteredDeclaration(e.name);r&&1===Object.keys(r.protos).length&&!this.isModifiedProto(e)&&this.adjustMethodForRemovedProtos(e,r)}),this),this.added&&this.added.methods&&this.added.methods.forEach((e=>{var r=t.getRegisteredDeclaration(e.name);r&&Object.keys(r.protos).length-e.protos.length==1&&this.adjustMethodForAddedProtos(e,r)}),this),this.removed&&this.removed.methods&&this.removed.methods.forEach((t=>{t.proto_to_remove&&(t.protos.push(t.proto_to_remove),Object(n.d)(t.protos,"proto"),delete t.proto_to_remove)})),this.added&&this.added.methods&&this.added.methods.forEach((t=>{t.proto_to_add&&(t.protos.push(t.proto_to_add),Object(n.d)(t.protos,"proto"),delete t.proto_to_add)}))}isModifiedProto(t){return!(!this.added||!this.added.methods)&&0!==this.added.methods.filter((e=>e.name===t.name)).length}adjustMethodForAddedProtos(t,e){var r=this.findPreExistingProto(t,e);if(r){var n={proto:r,main:e.protos[r].isEligibleAsMain()};this.removed||(this.removed=new o.a),this.findOrCreateMethod(this.removed,t.name).proto_to_remove=n,t.proto_to_add=n}}findPreExistingProto(t,e){for(var r in e.protos)if(e.protos.hasOwnProperty(r)){for(var n=!1,o=0;!n&&o<t.protos.length;o++)n=r===t.protos[o].proto;if(!n)return r}return null}adjustMethodForRemovedProtos(t,e){for(var r in e.protos)e.protos.hasOwnProperty(r)&&this.adjustMethodForRemovedProto(t,e,r)}adjustMethodForRemovedProto(t,e,r){var n={proto:r,main:e.protos[r].isEligibleAsMain()};t.proto_to_remove=n,this.added||(this.added=new o.a);var s=this.findOrCreateMethod(this.added,e.name);s.protos.forEach((t=>{n&&n.proto===t.proto&&(n=null)})),n&&(s.proto_to_add=n)}findOrCreateMethod(t,e){t.methods||(t.methods=[]);for(var r=0;r<t.methods.length;r++)if(t.methods[r].name===e)return t.methods[r];var n={name:e,protos:[]};return t.methods.push(n),n}}},function(t,e,r){"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}},function(t,e,r){"use strict";var n=r(1);function o(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var s;if(r)s=r(e);else if(n.isURLSearchParams(e))s=e.toString();else{var i=[];n.forEach(e,(function(t,e){null!=t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,(function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),i.push(o(e)+"="+o(t))})))})),s=i.join("&")}if(s){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+s}return t}},function(t,e,r){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,r){"use strict";(function(e){var n=r(1),o=r(22),s={"Content-Type":"application/x-www-form-urlencoded"};function i(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var a,c={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==e&&"[object process]"===Object.prototype.toString.call(e))&&(a=r(10)),a),transformRequest:[function(t,e){return o(e,"Accept"),o(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(i(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)?(i(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],(function(t){c.headers[t]={}})),n.forEach(["post","put","patch"],(function(t){c.headers[t]=n.merge(s)})),t.exports=c}).call(this,r(21))},function(t,e,r){"use strict";var n=r(1),o=r(23),s=r(25),i=r(7),a=r(26),c=r(29),l=r(30),u=r(11);t.exports=function(t){return new Promise((function(e,r){var h=t.data,d=t.headers;n.isFormData(h)&&delete d["Content-Type"];var p=new XMLHttpRequest;if(t.auth){var m=t.auth.username||"",f=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";d.Authorization="Basic "+btoa(m+":"+f)}var g=a(t.baseURL,t.url);if(p.open(t.method.toUpperCase(),i(g,t.params,t.paramsSerializer),!0),p.timeout=t.timeout,p.onreadystatechange=function(){if(p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in p?c(p.getAllResponseHeaders()):null,s={data:t.responseType&&"text"!==t.responseType?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:n,config:t,request:p};o(e,r,s),p=null}},p.onabort=function(){p&&(r(u("Request aborted",t,"ECONNABORTED",p)),p=null)},p.onerror=function(){r(u("Network Error",t,null,p)),p=null},p.ontimeout=function(){var e="timeout of "+t.timeout+"ms exceeded";t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),r(u(e,t,"ECONNABORTED",p)),p=null},n.isStandardBrowserEnv()){var v=(t.withCredentials||l(g))&&t.xsrfCookieName?s.read(t.xsrfCookieName):void 0;v&&(d[t.xsrfHeaderName]=v)}if("setRequestHeader"in p&&n.forEach(d,(function(t,e){void 0===h&&"content-type"===e.toLowerCase()?delete d[e]:p.setRequestHeader(e,t)})),n.isUndefined(t.withCredentials)||(p.withCredentials=!!t.withCredentials),t.responseType)try{p.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&p.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function(t){p&&(p.abort(),r(t),p=null)})),h||(h=null),p.send(h)}))}},function(t,e,r){"use strict";var n=r(24);t.exports=function(t,e,r,o,s){var i=new Error(t);return n(i,e,r,o,s)}},function(t,e,r){"use strict";var n=r(1);t.exports=function(t,e){e=e||{};var r={},o=["url","method","data"],s=["headers","auth","proxy","params"],i=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],a=["validateStatus"];function c(t,e){return n.isPlainObject(t)&&n.isPlainObject(e)?n.merge(t,e):n.isPlainObject(e)?n.merge({},e):n.isArray(e)?e.slice():e}function l(o){n.isUndefined(e[o])?n.isUndefined(t[o])||(r[o]=c(void 0,t[o])):r[o]=c(t[o],e[o])}n.forEach(o,(function(t){n.isUndefined(e[t])||(r[t]=c(void 0,e[t]))})),n.forEach(s,l),n.forEach(i,(function(o){n.isUndefined(e[o])?n.isUndefined(t[o])||(r[o]=c(void 0,t[o])):r[o]=c(void 0,e[o])})),n.forEach(a,(function(n){n in e?r[n]=c(t[n],e[n]):n in t&&(r[n]=c(void 0,t[n]))}));var u=o.concat(s).concat(i).concat(a),h=Object.keys(t).concat(Object.keys(e)).filter((function(t){return-1===u.indexOf(t)}));return n.forEach(h,l),r}},function(t,e,r){"use strict";function n(t){this.message=t}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,t.exports=n},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return a}));var n=r(0),o=r(2),s=r(5),i=null;class a{constructor(){!function(){var e=t||window||self||this;i=e.prompto}(),this.librariesContext=i.runtime.Context.newGlobalsContext(),this.projectContext=i.runtime.Context.newGlobalsContext(),this.projectContext.setParentContext(this.librariesContext),this.moduleId=null,this.lastSuccess=[],this.lastDialect="E",this.statuses={}}reset(){this.lastSuccess=[]}registerLibraryCode(t,e){Object(n.c)(t,e).register(this.librariesContext)}registerLibraryDeclarations(t){t.forEach((t=>{Object(n.c)(t.value.body,t.value.dialect).register(this.librariesContext)}),this)}clearLibrariesContext(){this.librariesContext=i.runtime.Context.newGlobalsContext(),this.projectContext.setParentContext(this.librariesContext)}publishLibraries(){return{type:"Document",value:{removed:{type:"Document",value:{}},added:this.librariesContext.getCatalog(),core:!0}}}publishProject(){return{type:"Document",value:{removed:{type:"Document",value:{}},added:this.projectContext.getLocalCatalog(),project:!0}}}unpublishProject(){var t={type:"Document",value:{removed:this.projectContext.getLocalCatalog(),added:{type:"Document",value:{}}}};return this.projectContext=i.runtime.Context.newGlobalsContext(),this.projectContext.setParentContext(this.librariesContext),this.statuses={},t}registerProjectDeclarations(t,e){this.moduleId=t,e.forEach((t=>{Object(n.c)(t.value.body,t.value.dialect).register(this.projectContext),t.value.module&&(delete t.value.module.value.dependencies,delete t.value.module.value.image),this.registerClean(t)}),this)}getDeclarationBody(t,e){var r=this.getDeclaration(t);return Object(n.f)(this.projectContext,r,e)}getDeclaration(t){if("TestRef"===t.type)return this.projectContext.getRegisteredTest(t.name);if("MethodRef"===t.type){var e=this.projectContext.getRegisteredDeclaration(t.name);return t.proto?e.protos[t.proto]:e.getFirst()}return this.projectContext.getRegisteredDeclaration(t.name)}idFromDbDecl(t){return"MethodDeclaration"===t.type?t.value.name+"/"+(t.value.prototype||""):t.value.name}idFromContent(t){return"method"===t.subType?t.name+"/"+(t.proto||""):t.name}idFromDecl(t){return t.name+(void 0!==t.getProto?"/"+(t.getProto()||""):"")}registerClean(t){var e=this.idFromDbDecl(t);this.statuses[e]={stuff:t,editStatus:"CLEAN"}}registerDestroyed(t){var e=this.statuses[t];e&&(e.editStatus="DELETED")}registerDirty(t,e,r){t.forEach((t=>{var n,o=this.idFromDecl(t),s=this.statuses[o];if(s){n=s.stuff.value;var i=t.fetchBody(e);n.dialect===r&&n.body===i||(n.dialect=r,n.body=i,"CREATED"!==s.editStatus&&(s.editStatus="DIRTY"),void 0!==t.getProto&&(n.prototype=t.getProto()),void 0!==t.storable&&(n.storable=t.storable),t.symbols&&(n.symbols=t.symbols.map((function(t){return t.name}))),t.derivedFrom?n.derivedFrom=t.derivedFrom.map((function(t){return t.name})):n.derivedFrom&&(n.derivedFrom=[]),t.annotations?n.annotations=t.annotations.map((function(t){return t.name})):n.annotations&&(n.annotations=[]))}else n={name:t.name,version:"0.0.1",dialect:r,body:t.fetchBody(e),module:{type:"Module",value:{dbId:this.moduleId}}},void 0!==t.getProto&&(n.prototype=t.getProto()),void 0!==t.storable&&(n.storable=t.storable),t.symbols&&(n.symbols=t.symbols.map((function(t){return t.name}))),t.derivedFrom&&(n.derivedFrom=t.derivedFrom.map((function(t){return t.name}))),t.annotations&&(n.annotations=t.annotations.map((function(t){return t.name}))),this.statuses[o]={editStatus:"CREATED",stuff:{type:t.getDeclarationType()+"Declaration",value:n}}}),this)}registerCommitted(t){var e=this;t.forEach((t=>{var r=e.idFromDbDecl(t);e.statuses[r].stuff.value.dbId=t.value.dbId,e.statuses[r].editStatus="CLEAN"})),this.clearDeleted()}clearDeleted(){var t=[];for(var e in this.statuses)this.statuses.hasOwnProperty(e)&&"DELETED"===this.statuses[e].editStatus&&t.push(e);t.forEach((t=>{delete this.statuses[t]}),this)}prepareCommit(){var t=[];for(var e in this.statuses)this.statuses.hasOwnProperty(e)&&"CLEAN"!==this.statuses[e].editStatus&&t.push({type:"EditedStuff",value:this.statuses[e]});return t.length?t:null}translate(t,e,r){return Object(n.e)(this.projectContext,t,e,r)}handleDestroyed(t){var e=this.idFromContent(t);this.registerDestroyed(e);var r=this.statuses[e];if(r&&"DELETED"===r.editStatus){var i=Object(n.c)(r.stuff.value.body,r.stuff.value.dialect);i[0].unregister(this.projectContext);var a=new s.a;return a.removed=new o.a(i,this.librariesContext),a.filterOutDuplicates(),a}return null}handleSetContent(t,e,r){try{return this.doHandleSetContent(t,e,r)}catch(t){return this.handleUnhandled(t,r)}}doHandleSetContent(t,e,r){var o=Object(n.c)(t,e,r),s=this.projectContext.problemListener;try{this.projectContext.problemListener=r,o.check(this.projectContext.newChildContext())}finally{this.projectContext.problemListener=s}this.lastSuccess=o,this.lastDialect=e}handleEditContent(t,e,r,n){try{return this.doHandleEditContent(t,e,r,n)}catch(t){return this.handleUnhandled(t,r)}}handleUnhandled(t,e){if(!e.problems.length){e.collectProblem({startLine:1,startColumn:0,endLine:1e3,endColumn:1e3,type:"error",message:"Invalid syntax!"})}return null}doHandleEditContent(t,e,r,o){var s=Date.now(),i=this.lastSuccess,a=Object(n.b)(t,e,r),c=a.parse(),l=Date.now();self.logDebug("parse time: "+(l-s)+" ms"),this.checkDuplicates(i,c,r);var u=Date.now();if(self.logDebug("check duplicates time: "+(u-l)+" ms"),0===r.problems.length){this.lastSuccess=c,this.lastDialect=e;var h=this.updateCodebase(i,c,a,e,r),d=Date.now();if(self.logDebug("repo update time: "+(d-u)+" ms"),h){var p=h.getContent();return o&&1===c.length&&(p.selected=c[0].name),p.editedCount=c.length,i.length<=1&&1===c.length&&(p.created=c[0].name),p}return null}return null}checkDuplicates(t,e,r){return e.some((e=>!!this.isDuplicate(e,t)&&(r.reportDuplicate(e.name,e),!0)),this)}isDuplicate(t,e){if(e.some((e=>e.name===t.name)))return!1;var r=this.projectContext.getRegisteredDeclaration(t.name);return r instanceof i.runtime.MethodDeclarationMap?!(t instanceof i.declaration.BaseMethodDeclaration)||r.hasProto(t.getProto()):!!r}updateCodebase(t,e,r,n,i){var a=new s.a;a.removed=new o.a(t,this.projectContext,this.librariesContext),a.added=new o.a(e,this.projectContext,this.librariesContext);var c=a.filterOutDuplicates(),l=this.updateRenamed(c,t,e,r,n);return this.updateAppContext(t,e,i),l||this.registerDirty(e,r,n),0!==c?(a.adjustForMovingProtos(this.projectContext),a):null}updateRenamed(t,e,r,n,o){if(2!==t||0===e.length||r.length!==e.length)return!1;var s=r.filter((t=>{var e=this.idFromDecl(t);return null===(this.statuses[e]||null)}),this);if(1===s.length){var i=s[0],a=this.idFromDecl(i),c=this.statuses[a],l=e.filter((function(t){var e=this.idFromDecl(t);return 0===r.filter((function(t){return e===this.idFromDecl(t)}),this).length}),this);if(1===l.length){var u=l[0],h=this.idFromDecl(u),d=this.statuses[h];if(d&&!c){this.statuses[a]=this.statuses[h],delete this.statuses[h],"CREATED"!==(c=d).editStatus&&(c.editStatus="DIRTY"),c.stuff.type=i.getDeclarationType()+"Declaration";var p=c.stuff.value;return p.name=i.name,p.dialect=o,p.body=i.fetchBody(n),void 0!==i.getProto&&(p.prototype=i.getProto()),void 0!==i.storable&&(p.storable=i.storable),!0}}}return!1}updateAppContext(t,e,r){t.unregister(this.projectContext),e.unregister(this.projectContext);var n=this.projectContext.problemListener;try{this.projectContext.problemListener=r,e.register(this.projectContext),e.check(this.projectContext.newChildContext())}finally{this.projectContext.problemListener=n}}locateContent(t){return t.categoryName&&t.categoryName.length?this.locateCategoryContent(t):this.locateMethodContent(t)}locateCategoryContent(t){var e=this.librariesContext.getRegisteredDeclaration(t.categoryName);return e?{type:"Prompto",subType:this.subTypeFromDeclaration(e),name:t.categoryName,core:!0}:(e=this.projectContext.getRegisteredDeclaration(t.categoryName))?{type:"Prompto",subType:this.subTypeFromDeclaration(e),name:t.categoryName,core:!1}:null}subTypeFromDeclaration(t){return t instanceof i.declaration.EnumeratedCategoryDeclaration||t instanceof i.declaration.EnumeratedNativeDeclaration?"enumeration":"category"}locateMethodContent(t){var e=this.librariesContext.getRegisteredTest(t.methodName);if(e)return{type:"Prompto",subType:"test",name:t.methodName,core:!0,main:!1};var r=this.librariesContext.getRegisteredDeclaration(t.methodName);if(r){var n=t.methodProto?r.protos[t.methodProto]:r.getFirst();if(n)return{type:"Prompto",subType:"method",name:t.methodName,proto:t.methodProto,core:!0,main:n.isEligibleAsMain()}}if(e=this.projectContext.getRegisteredTest(t.methodName))return{type:"Prompto",subType:"test",name:t.methodName,core:!1,main:!1};if(r=this.projectContext.getRegisteredDeclaration(t.methodName)){var o=t.methodProto?r.protos[t.methodProto]:r.getFirst();if(o)return{type:"Prompto",subType:"method",name:t.methodName,proto:t.methodProto,core:!1,main:o.isEligibleAsMain()}}return null}locateSection(t){var e=null;if("category"===t.type)e=this.projectContext.getRegisteredDeclaration(t.name);else if("method"===t.type){var r=this.projectContext.getRegisteredDeclaration(t.name);r&&(e=r.protos[t.prototype])}else"test"===t.type&&(e=this.projectContext.getRegisteredTest(t.name));if(null==e)return null;var n=e.locateSectionAtLine(t.line);return null==n?null:((n=new i.parser.Section(n).asObject()).path||(n.path="store:/"+t.type+"/"+t.name+("method"===t.type?"/"+t.prototype:"")),n)}}}).call(this,r(4))},function(t,e){var r=self;r.Honey={requirePath:[".."]},r.importScripts("/js/lib/require.js","/js/lib/prompto.core.bundle.js");r.logDebug=console.log,console.error=console.warn=console.log=console.trace=function(){var t=Array.prototype.slice.call(arguments,0);r.logDebug(t),postMessage({type:"log",data:t})};var n=r.prompto.problem.ProblemCollector;r.AnnotatingErrorListener=function(t){var e=new n(t);return e.collectProblem=function(t){t={row:t.startLine-1,column:t.startColumn,endRow:t.endLine-1,endColumn:t.endColumn,type:t.type,text:t.message},this.problems.push(t)},e}},function(t,e,r){"use strict";var n=r(1),o=r(6),s=r(17),i=r(12);function a(t){var e=new s(t),r=o(s.prototype.request,e);return n.extend(r,s.prototype,e),n.extend(r,e),r}var c=a(r(9));c.Axios=s,c.create=function(t){return a(i(c.defaults,t))},c.Cancel=r(13),c.CancelToken=r(31),c.isCancel=r(8),c.all=function(t){return Promise.all(t)},c.spread=r(32),t.exports=c,t.exports.default=c},function(t,e,r){"use strict";var n=r(1),o=r(7),s=r(18),i=r(19),a=r(12);function c(t){this.defaults=t,this.interceptors={request:new s,response:new s}}c.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=[i,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach((function(t){e.unshift(t.fulfilled,t.rejected)})),this.interceptors.response.forEach((function(t){e.push(t.fulfilled,t.rejected)}));e.length;)r=r.then(e.shift(),e.shift());return r},c.prototype.getUri=function(t){return t=a(this.defaults,t),o(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(t){c.prototype[t]=function(e,r){return this.request(a(r||{},{method:t,url:e,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(t){c.prototype[t]=function(e,r,n){return this.request(a(n||{},{method:t,url:e,data:r}))}})),t.exports=c},function(t,e,r){"use strict";var n=r(1);function o(){this.handlers=[]}o.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},o.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},o.prototype.forEach=function(t){n.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=o},function(t,e,r){"use strict";var n=r(1),o=r(20),s=r(8),i=r(9);function a(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return a(t),t.headers=t.headers||{},t.data=o(t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||i.adapter)(t).then((function(e){return a(t),e.data=o(e.data,e.headers,t.transformResponse),e}),(function(e){return s(e)||(a(t),e&&e.response&&(e.response.data=o(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},function(t,e,r){"use strict";var n=r(1);t.exports=function(t,e,r){return n.forEach(r,(function(r){t=r(t,e)})),t}},function(t,e){var r,n,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(t){n=i}}();var c,l=[],u=!1,h=-1;function d(){u&&c&&(u=!1,c.length?l=c.concat(l):h=-1,l.length&&p())}function p(){if(!u){var t=a(d);u=!0;for(var e=l.length;e;){for(c=l,l=[];++h<e;)c&&c[h].run();h=-1,e=l.length}c=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function f(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];l.push(new m(t,e)),1!==l.length||u||a(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e,r){"use strict";var n=r(1);t.exports=function(t,e){n.forEach(t,(function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])}))}},function(t,e,r){"use strict";var n=r(11);t.exports=function(t,e,r){var o=r.config.validateStatus;r.status&&o&&!o(r.status)?e(n("Request failed with status code "+r.status,r.config,null,r.request,r)):t(r)}},function(t,e,r){"use strict";t.exports=function(t,e,r,n,o){return t.config=e,r&&(t.code=r),t.request=n,t.response=o,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},t}},function(t,e,r){"use strict";var n=r(1);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,r,o,s,i){var a=[];a.push(t+"="+encodeURIComponent(e)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(o)&&a.push("path="+o),n.isString(s)&&a.push("domain="+s),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,r){"use strict";var n=r(27),o=r(28);t.exports=function(t,e){return t&&!n(e)?o(t,e):e}},function(t,e,r){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,r){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,r){"use strict";var n=r(1),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,s,i={};return t?(n.forEach(t.split("\n"),(function(t){if(s=t.indexOf(":"),e=n.trim(t.substr(0,s)).toLowerCase(),r=n.trim(t.substr(s+1)),e){if(i[e]&&o.indexOf(e)>=0)return;i[e]="set-cookie"===e?(i[e]?i[e]:[]).concat([r]):i[e]?i[e]+", "+r:r}})),i):i}},function(t,e,r){"use strict";var n=r(1);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function o(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=o(window.location.href),function(e){var r=n.isString(e)?o(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},function(t,e,r){"use strict";var n=r(13);function o(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var r=this;t((function(t){r.reason||(r.reason=new n(t),e(r.reason))}))}o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.source=function(){var t;return{token:new o((function(e){t=e})),cancel:t}},t.exports=o},function(t,e,r){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e,r){"use strict";r.r(e);r(15);var n=function(){this.propagationStopped=!0},o=function(){this.defaultPrevented=!0};class s{constructor(){this._emit=this._dispatchEvent,this.on=this.addEventListener,this.off=this.removeEventListener,this.removeListener=this.removeEventListener}dispatchEvent(t,e){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var r=this._eventRegistry[t]||[],s=this._defaultHandlers[t];if(r.length||s){"object"==typeof e&&e||(e={}),e.type||(e.type=t),e.stopPropagation||(e.stopPropagation=n),e.preventDefault||(e.preventDefault=o),r=r.slice();for(var i=0;i<r.length&&(r[i](e,this),!e.propagationStopped);i++);return s&&!e.defaultPrevented?s(e,this):void 0}}_signal(t,e){var r=(this._eventRegistry||{})[t];if(r){r=r.slice();for(var n=0;n<r.length;n++)r[n](e,this)}}once(t,e){var r=this;if(this.addEventListener(t,(function n(){r.removeEventListener(t,n),e.apply(null,arguments)})),!e)return new Promise((function(t){e=t}))}setDefaultHandler(t,e){var r=this._defaultHandlers;if(r||(r=this._defaultHandlers={_disabled_:{}}),r[t]){var n=r[t],o=r._disabled_[t];o||(r._disabled_[t]=o=[]),o.push(n);var s=o.indexOf(e);-1!==s&&o.splice(s,1)}r[t]=e}removeDefaultHandler(t,e){var r=this._defaultHandlers;if(r){var n=r._disabled_[t];if(r[t]===e)n&&this.setDefaultHandler(t,n.pop());else if(n){var o=n.indexOf(e);-1!==o&&n.splice(o,1)}}}addEventListener(t,e,r){this._eventRegistry=this._eventRegistry||{};var n=this._eventRegistry[t];return n||(n=this._eventRegistry[t]=[]),-1===n.indexOf(e)&&n[r?"unshift":"push"](e),e}removeEventListener(t,e){this._eventRegistry=this._eventRegistry||{};var r=this._eventRegistry[t];if(r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}removeAllListeners(t){this._eventRegistry&&(this._eventRegistry[t]=[])}}class i{constructor(t,e,r,n){var o,s,i;i=function(t,e){this.start.row+=t,this.start.column+=e,this.end.row+=t,this.end.column+=e},(s="moveBy")in(o=this)?Object.defineProperty(o,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[s]=i,this.start={row:t,column:e},this.end={row:r,column:n}}isEqual(t){return this.start.row===t.start.row&&this.end.row===t.end.row&&this.start.column===t.start.column&&this.end.column===t.end.column}toString(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"}contains(t,e){return 0===this.compare(t,e)}compareRange(t){var e,r=t.end,n=t.start;return 1===(e=this.compare(r.row,r.column))?1===(e=this.compare(n.row,n.column))?2:0===e?1:0:-1===e?-2:-1===(e=this.compare(n.row,n.column))?-1:1===e?42:0}comparePoint(t){return this.compare(t.row,t.column)}containsRange(t){return 0===this.comparePoint(t.start)&&0===this.comparePoint(t.end)}intersects(t){var e=this.compareRange(t);return-1===e||0===e||1===e}isEnd(t,e){return this.end.row===t&&this.end.column===e}isStart(t,e){return this.start.row===t&&this.start.column===e}setStart(t,e){"object"==typeof t?(this.start.column=t.column,this.start.row=t.row):(this.start.row=t,this.start.column=e)}setEnd(t,e){"object"==typeof t?(this.end.column=t.column,this.end.row=t.row):(this.end.row=t,this.end.column=e)}inside(t,e){return 0===this.compare(t,e)&&(!this.isEnd(t,e)&&!this.isStart(t,e))}insideStart(t,e){return 0===this.compare(t,e)&&!this.isEnd(t,e)}insideEnd(t,e){return 0===this.compare(t,e)&&!this.isStart(t,e)}compare(t,e){return this.isMultiLine()||t!==this.start.row?t<this.start.row?-1:t>this.end.row?1:this.start.row===t?e>=this.start.column?0:-1:this.end.row===t?e<=this.end.column?0:1:0:e<this.start.column?-1:e>this.end.column?1:0}compareStart(t,e){return this.start.row===t&&this.start.column===e?-1:this.compare(t,e)}compareEnd(t,e){return this.end.row===t&&this.end.column===e?1:this.compare(t,e)}compareInside(t,e){return this.end.row===t&&this.end.column===e?1:this.start.row===t&&this.start.column===e?-1:this.compare(t,e)}clipRows(t,e){var r,n;return this.end.row>e?n={row:e+1,column:0}:this.end.row<t&&(n={row:t,column:0}),this.start.row>e?r={row:e+1,column:0}:this.start.row<t&&(r={row:t,column:0}),i.fromPoints(r||this.start,n||this.end)}extend(t,e){var r=this.compare(t,e);if(0===r)return this;if(-1===r)var n={row:t,column:e};else var o={row:t,column:e};return i.fromPoints(n||this.start,o||this.end)}isEmpty(){return this.start.row===this.end.row&&this.start.column===this.end.column}isMultiLine(){return this.start.row!==this.end.row}clone(){return i.fromPoints(this.start,this.end)}collapseRows(){return 0===this.end.column?new i(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new i(this.start.row,0,this.end.row,0)}toScreenRange(t){var e=t.documentToScreenPosition(this.start),r=t.documentToScreenPosition(this.end);return new i(e.row,e.column,r.row,r.column)}static fromPoints(t,e){return new i(t.row,t.column,e.row,e.column)}static comparePoints(t,e){return t.row-e.row||t.column-e.column}}function a(t,e,r){var n=r?t.column<=e.column:t.column<e.column;return t.row<e.row||t.row===e.row&&n}class c{constructor(t,e,r){this.$onChange=this.onChange.bind(this),this.attach(t),void 0===r?this.setPosition(e.row,e.column):this.setPosition(e,r),this.$insertRight=!1}getPosition(){return this.$clipPositionToDocument(this.row,this.column)}getDocument(){return this.document}onChange(t){if(!(t.start.row===t.end.row&&t.start.row!==this.row||t.start.row>this.row)){var e=function(t,e,r){var n="insert"===t.action,o=(n?1:-1)*(t.end.row-t.start.row),s=(n?1:-1)*(t.end.column-t.start.column),i=t.start,c=n?i:t.end;return a(e,i,r)?{row:e.row,column:e.column}:a(c,e,!r)?{row:e.row+o,column:e.column+(e.row===c.row?s:0)}:{row:i.row,column:i.column}}(t,{row:this.row,column:this.column},this.$insertRight);this.setPosition(e.row,e.column,!0)}}setPosition(t,e,r){var n;if(n=r?{row:t,column:e}:this.$clipPositionToDocument(t,e),this.row!==n.row||this.column!==n.column){var o={row:this.row,column:this.column};this.row=n.row,this.column=n.column,this._signal("change",{old:o,value:n})}}detach(){this.document.removeEventListener("change",this.$onChange)}attach(t){this.document=t||this.document,this.document.on("change",this.$onChange)}$clipPositionToDocument(t,e){var r={};return t>=this.document.getLength()?(r.row=Math.max(0,this.document.getLength()-1),r.column=this.document.getLine(r.row).length):t<0?(r.row=0,r.column=0):(r.row=t,r.column=Math.min(this.document.getLine(r.row).length,Math.max(0,e))),e<0&&(r.column=0),r}}class l extends s{constructor(t){super(),this.$lines=[""],this.$autoNewLine="",this.$newLineMode="auto",0===t.length?this.$lines=[""]:Array.isArray(t)?this.insertMergedLines({row:0,column:0},t):this.insert({row:0,column:0},t)}setValue(t){var e=this.getLength()-1;this.remove(new i(0,0,e,this.getLine(e).length)),this.insert({row:0,column:0},t)}getValue(){return this.getAllLines().join(this.getNewLineCharacter())}createAnchor(t,e){return new c(this,t,e)}$split(t){return t.split(/\r\n|\r|\n/)}$detectNewLine(t){var e=t.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=e?e[1]:"\n",this._signal("changeNewLineMode")}getNewLineCharacter(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";default:return this.$autoNewLine||"\n"}}setNewLineMode(t){this.$newLineMode!==t&&(this.$newLineMode=t,this._signal("changeNewLineMode"))}getNewLineMode(){return this.$newLineMode}isNewLine(t){return"\r\n"===t||"\r"===t||"\n"===t}getLine(t){return this.$lines[t]||""}getLines(t,e){return this.$lines.slice(t,e+1)}getAllLines(){return this.getLines(0,this.getLength())}getLength(){return this.$lines.length}getTextRange(t){return this.getLinesForRange(t).join(this.getNewLineCharacter())}getLinesForRange(t){var e;if(t.start.row===t.end.row)e=[this.getLine(t.start.row).substring(t.start.column,t.end.column)];else{(e=this.getLines(t.start.row,t.end.row))[0]=(e[0]||"").substring(t.start.column);var r=e.length-1;t.end.row-t.start.row===r&&(e[r]=e[r].substring(0,t.end.column))}return e}insertLines(t,e){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(t,e)}removeLines(t,e){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(t,e)}insertNewLine(t){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead."),this.insertMergedLines(t,["",""])}insert(t,e){return this.getLength()<=1&&this.$detectNewLine(e),this.insertMergedLines(t,this.$split(e))}insertInLine(t,e){var r=this.clippedPos(t.row,t.column),n=this.pos(t.row,t.column+e.length);return this.applyDelta({start:r,end:n,action:"insert",lines:[e]},!0),this.clonePos(n)}clippedPos(t,e){var r=this.getLength();void 0===t?t=r:t<0?t=0:t>=r&&(t=r-1,e=void 0);var n=this.getLine(t);return void 0===e&&(e=n.length),{row:t,column:e=Math.min(Math.max(e,0),n.length)}}clonePos(t){return{row:t.row,column:t.column}}pos(t,e){return{row:t,column:e}}$clipPosition(t){var e=this.getLength();return t.row>=e?(t.row=Math.max(0,e-1),t.column=this.getLine(e-1).length):(t.row=Math.max(0,t.row),t.column=Math.min(Math.max(t.column,0),this.getLine(t.row).length)),t}insertFullLines(t,e){var r=0;(t=Math.min(Math.max(t,0),this.getLength()))<this.getLength()?(e=e.concat([""]),r=0):(e=[""].concat(e),t--,r=this.$lines[t].length),this.insertMergedLines({row:t,column:r},e)}insertMergedLines(t,e){var r=this.clippedPos(t.row,t.column),n={row:r.row+e.length-1,column:(1===e.length?r.column:0)+e[e.length-1].length};return this.applyDelta({start:r,end:n,action:"insert",lines:e}),this.clonePos(n)}remove(t){var e=this.clippedPos(t.start.row,t.start.column),r=this.clippedPos(t.end.row,t.end.column);return this.applyDelta({start:e,end:r,action:"remove",lines:this.getLinesForRange({start:e,end:r})}),this.clonePos(e)}removeInLine(t,e,r){var n=this.clippedPos(t,e),o=this.clippedPos(t,r);return this.applyDelta({start:n,end:o,action:"remove",lines:this.getLinesForRange({start:n,end:o})},!0),this.clonePos(n)}removeFullLines(t,e){t=Math.min(Math.max(0,t),this.getLength()-1);var r=(e=Math.min(Math.max(0,e),this.getLength()-1))===this.getLength()-1&&t>0,n=e<this.getLength()-1,o=r?t-1:t,s=r?this.getLine(o).length:0,a=n?e+1:e,c=n?0:this.getLine(a).length,l=new i(o,s,a,c),u=this.$lines.slice(t,e+1);return this.applyDelta({start:l.start,end:l.end,action:"remove",lines:this.getLinesForRange(l)}),u}removeNewLine(t){t<this.getLength()-1&&t>=0&&this.applyDelta({start:this.pos(t,this.getLine(t).length),end:this.pos(t+1,0),action:"remove",lines:["",""]})}replace(t,e){return t instanceof i||(t=i.fromPoints(t.start,t.end)),0===e.length&&t.isEmpty()?t.start:e===this.getTextRange(t)?t.end:(this.remove(t),e?this.insert(t.start,e):t.start)}applyDeltas(t){for(var e=0;e<t.length;e++)this.applyDelta(t[e])}revertDeltas(t){for(var e=t.length-1;e>=0;e--)this.revertDelta(t[e])}applyDelta(t,e){var r="insert"===t.action;(r?t.lines.length<=1&&!t.lines[0]:!i.comparePoints(t.start,t.end))||(r&&t.lines.length>2e4?this.$splitAndapplyLargeDelta(t,2e4):(!function(t,e,r){var n=e.start.row,o=e.start.column,s=t[n]||"";switch(e.action){case"insert":if(1===e.lines.length)t[n]=s.substring(0,o)+e.lines[0]+s.substring(o);else{var i=[n,1].concat(e.lines);t.splice.apply(t,i),t[n]=s.substring(0,o)+t[n],t[n+e.lines.length-1]+=s.substring(o)}break;case"remove":var a=e.end.column,c=e.end.row;n===c?t[n]=s.substring(0,o)+s.substring(a):t.splice(n,c-n+1,s.substring(0,o)+t[c].substring(a));break;default:throw new Error("Unsupported: "+e.action)}}(this.$lines,t),this._signal("change",t)))}$splitAndapplyLargeDelta(t,e){for(var r=t.lines,n=r.length-e+1,o=t.start.row,s=t.start.column,i=0,a=0;i<n;i=a){a+=e-1;var c=r.slice(i,a);c.push(""),this.applyDelta({start:this.pos(o+i,s),end:this.pos(o+a,s=0),action:t.action,lines:c},!0)}t.lines=r.slice(i),t.start.row=o+i,t.start.column=s,this.applyDelta(t,!0)}revertDelta(t){this.applyDelta({start:this.clonePos(t.start),end:this.clonePos(t.end),action:"insert"===t.action?"remove":"insert",lines:t.lines.slice()})}indexToPosition(t,e){for(var r=this.$lines||this.getAllLines(),n=this.getNewLineCharacter().length,o=e||0,s=r.length;o<s;o++)if((t-=r[o].length+n)<0)return{row:o,column:t+r[o].length+n};return{row:s-1,column:t+r[s-1].length+n}}positionToIndex(t,e){for(var r=this.$lines||this.getAllLines(),n=this.getNewLineCharacter().length,o=0,s=Math.min(t.row,r.length),i=e||0;i<s;++i)o+=r[i].length+n;return o+t.column}}var u=r(14),h="O",d=r(3),p=r.n(d);function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach((function(e){g(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function g(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var v=self||window;class w{constructor(){this.$authorization=null,this.onSuccess=this.onSuccess.bind(this),this.prepareConfig=this.prepareConfig.bind(this),this.collectHeaders=this.collectHeaders.bind(this)}prepareConfig(t){if("/"!==t[0]&&"."!==t[0]){var e={"Access-Control-Allow-Origin":"*"};return null!==this.$authorization&&(e=f(f({},e),{},{"X-Authorization":this.$authorization})),{withCredentials:!0,headers:e}}return{}}postJSON(t,e,r,n){this.postTEXT(t,e,(t=>{var e="string"==typeof t?JSON.parse(t):t;r(e)}),n)}postTEXT(t,e,r,n){n=n||console.log;var o=this.prepareConfig(t);p.a.post(t,e,o).then((e=>this.onSuccess(e,t,r,n))).catch(n)}getJSON(t,e,r,n){this.getTEXT(t,e,(t=>{var e="string"==typeof t?JSON.parse(t):t;r(e)}),n)}getTEXT(t,e,r,n){n=n||console.log;var o=this.prepareConfig(t);e&&(o=f(f({},o),{},{params:e})),p.a.get(t,o).then((e=>this.onSuccess(e,t,r,n))).catch(n)}onSuccess(t,e,r,n){200===t.status?(this.collectHeaders(t,e),r(t.data)):n("Failed to load "+e+", error: "+t.status)}collectHeaders(t,e){"/"!==e[0]&&"."!==e[0]||(this.$authorization=t.headers["X-Authorization"]||null)}clearModuleContext(t,e,r){var n=[{name:"dbId",value:t}],o={params:JSON.stringify(n)};p.a.get("/ws/run/clearModuleContext",{params:o}).then((t=>{var r=t.data;r.error||(-1===r.data?alert("Server is not running!"):e&&e(r.data))})).catch((t=>r?r(t):{}))}fetchModulePort(t,e,r,n){var o=[{name:"dbId",value:t},{name:"action",type:"Text",value:e}],s={params:JSON.stringify(o)};p.a.get("/ws/run/fetchModulePort",{params:s}).then((t=>{var e=t.data;e.error||(-1===e.data?alert("Server is not running!"):r(e.data))})).catch((t=>n(t)))}fetchModuleURL(t,e,r,n){this.fetchModulePort(t,e,(t=>{var e=v.location.protocol+"//"+v.location.hostname+":"+t+"/";r(e)}),n)}}w.instance=new w;class y{runContent(t,e,r,n){throw new Error("Unsupported!")}startDebugContent(t,e,r,n,o){throw new Error("Unsupported!")}}var b,C,D,x=(self||window).prompto;class L{static forMode(t){var e=L.types[t];return e?new e:null}}b=L,C="types",D={LI:class extends y{runContent(t,e,r,n){"test"===r.subType?this.runTest(e,r,n):this.runMethod(e,r,n)}runTest(t,e,r){var n=x.store.$DataStore.instance;x.store.$DataStore.instance=new x.memstore.MemStore;try{x.runtime.Interpreter.interpretTest(t.projectContext,e.name)}finally{x.store.$DataStore.instance=n,r()}}runMethod(t,e,r){try{x.runtime.Interpreter.interpret(t.projectContext,e.name,""),console.log("Finished running "+e.name)}finally{r()}}},LE:class extends y{}},C in b?Object.defineProperty(b,C,{value:D,enumerable:!0,configurable:!0,writable:!0}):b[C]=D;var j=self||window,P=j.prompto;var O=new class extends s{callback(t,e){postMessage({type:"call",id:e,data:t})}emit(t,e){postMessage({type:"event",name:t,data:e})}},E=new class extends class{constructor(t){var e,r,n,o,s;this.sender=t,this.$timeout=0,this.doc=new l(""),this.deferredUpdate=(e=this.onUpdate.bind(this),n=null,o=function(){n=null,e()},(s=function(t){null==n&&(n=setTimeout(o,t||r))}).delay=function(t){n&&clearTimeout(n),n=setTimeout(o,t||r)},s.schedule=s,s.call=function(){this.cancel(),e()},s.cancel=function(){n&&clearTimeout(n),n=null},s.isPending=function(){return n},s),t.on("change",this.processChange.bind(this)),t.on("changes",this.processChanges.bind(this))}processChanges(t){for(var e=t.data,r=0;r<e.length;r++)this.applyChange(e[r]);return this.invokeUpdate()}processChange(t){var e=t.data;return this.applyChange(e),this.invokeUpdate()}invokeUpdate(){if(this.$timeout)return this.deferredUpdate.schedule(this.$timeout);this.onUpdate()}applyChange(t){var e=this.doc;if(t[0].start)e.applyDeltas(t);else for(var r=0;r<t.length;r+=2){var n=Array.isArray(t[r+1])?{action:"insert",start:t[r],lines:t[r+1]}:{action:"remove",start:t[r],end:t[r+1]};e.applyDelta(n,!0)}}setTimeout(t){this.$timeout=t}setValue(t){this.doc.setValue(t),this.deferredUpdate.schedule(this.$timeout)}getValue(t){this.sender.callback(this.doc.getValue(),t)}onUpdate(){}isPending(){return this.deferredUpdate.isPending()}}{constructor(t){super(t),this.$projectId=null,this.$project=null,this.$dialect=h,this.$value=this.doc.getValue(),this.$core=!1,this.$repo=new u.a,this.$loading={},this.onInit()}onInit(){this.markLoading("Project"),this.markLoading("%Description%"),this.loadCore()}loadCore(){this.markLoading("Core"),w.instance.getTEXT("prompto/prompto.pec",null,(t=>{this.$repo.registerLibraryCode(t,"E"),this.markLoaded("Core")}))}setProject(t,e){this.$projectId=t,this.unpublishProject(),this.loadProject(e)}onUpdate(){delete this.$created;var t=this.doc.getValue(),e=new j.AnnotatingErrorListener;if(t!==this.$value||this.$selectedContent){var r=this.$repo.handleEditContent(t,this.$dialect,e,this.$selectedContent);delete this.$selectedContent,r&&(r.created&&(this.$created=r.created),this.sender.emit("contentUpdated",r))}else this.$repo.handleSetContent(t,this.$dialect,e);this.$value=t,this.sender.emit("annotate",e.problems)}setDialect(t){var e=this.$dialect;if(this.$dialect=t,e&&t!==e){var r=this.doc.getValue();r&&(this.$value=this.$repo.translate(r,e,t),this.sender.emit("value",this.$value))}}getResourceBody(t){var e=arguments[arguments.length-1],r=this.$repo.getDeclarationBody(t,this.$dialect);this.sender.callback(r,e)}locateContent(t){var e=arguments[arguments.length-1],r=this.$repo.locateContent(t);this.sender.callback(r,e)}locateSection(t){var e=arguments[arguments.length-1],r=this.$repo.locateSection(t);this.sender.callback(r,e)}destroy(t){this.$value="";var e=this.$repo.handleDestroyed(t);e&&this.sender.emit("catalogUpdated",e.getContent()),this.sender.emit("value",this.$value)}loadProject(t){this.fetchProjectDescription(this.$projectId,!0,(e=>{if(e.error);else{if(this.$project=e.data.value,t&&this.loadDependencies(),this.$project.stubResource)try{j.importScripts("/stub?moduleId="+this.$project.dbId+"&resourceName="+this.$project.stubResource)}catch(t){var r=t.stack;console.error(r)}this.markLoaded("%Description%"),this.fetchModuleDeclarations(this.$projectId,(t=>{if(t.error);else{var e=t.data.value;this.$repo.registerProjectDeclarations(this.$projectId,e.items),this.markLoaded("Project")}}))}}))}loadDependencies(){this.$project.dependencies&&this.$project.dependencies.value.filter((t=>null!=t)).map((t=>this.loadDependency(t.value||t)),this)}loadDependency(t){this.markLoading(t.name),this.fetchModuleDescription(t.name,t.version,(e=>{if(e.error);else{var r=e.data.value;if(r.stubResource)try{j.importScripts("/stub?moduleId="+r.dbId+"&resourceName="+r.stubResource)}catch(t){var n=t.stack;console.error(n)}this.fetchModuleDeclarations(r.dbId,(e=>{if(e.error);else{var r=e.data.value;this.$repo.registerLibraryDeclarations(r.items),this.markLoaded(t.name)}}))}}))}dependenciesUpdated(){this.$repo.clearLibrariesContext(),this.markLoading("Project"),this.markLoading("%Description%"),this.loadCore(),this.loadProject(!0)}fetchProjectDescription(t,e,r){var n=[{name:"dbId",value:t.toString()},{name:"register",type:"Boolean",value:e}];w.instance.getJSON("/ws/run/fetchModuleDescription",{params:JSON.stringify(n)},r)}fetchModuleDescription(t,e,r){var n=[{name:"name",type:"Text",value:t},{name:"version",type:e.type,value:e.value},{name:"register",type:"Boolean",value:!1}];w.instance.getJSON("/ws/run/fetchModuleDescription",{params:JSON.stringify(n)},r)}fetchModuleDeclarations(t,e){var r=[{name:"dbId",value:t.toString()}];w.instance.getJSON("/ws/run/fetchModuleDeclarations",{params:JSON.stringify(r)},e)}publishLibraries(){var t=this.$repo.publishLibraries();this.sender.emit("catalogUpdated",t)}publishProject(){var t=this.$repo.publishProject();this.sender.emit("catalogUpdated",t)}unpublishProject(){var t=this.$repo.unpublishProject();this.sender.emit("catalogUpdated",t)}markLoading(t){this.$loading[t]=!0}markLoaded(t){delete this.$loading[t],"Project"===t?this.publishProject():(1===Object.keys(this.$loading).length&&"Project"in this.$loading||0===Object.keys(this.$loading).length)&&this.publishLibraries()}prepareCommit(){var t=arguments[arguments.length-1],e=this.$repo.prepareCommit();this.sender.callback(e,t)}commitFailed(){}commitSuccessfull(){this.fetchModuleDeclarations(this.$projectId,(t=>{if(t.error);else{var e=t.data.value;this.$repo.registerCommitted(e.items)}}))}runTestOrMethod(t,e){var r=arguments[arguments.length-1],n=L.forMode(e);n?n.runContent(this.$projectId,this.$repo,t,(()=>this.sender.callback(null,r))):(console.log("Unsupported mode: "+e),this.sender.callback(null,r))}fetchRunnablePage(t){var e=arguments[arguments.length-1],r={valid:!1,content:null},n=this.$repo.getDeclaration(t);if(null!==n&&n.annotations&&n instanceof P.declaration.ConcreteWidgetDeclaration){var o=n.annotations.filter((function(t){return"@PageWidgetOf"===t.id.name}));if(o.length>0){var s=o[0].getDefaultArgument();s instanceof P.literal.TextLiteral&&(r={valid:!0,content:{type:"page",name:s.value.toString()}})}}this.sender.callback(r,e)}}(O),S=self;onmessage=function(t){var e=t.data;if(e.event&&O)O._signal(e.event,e.data);else if(e.command)if(E[e.command])E[e.command].apply(E,e.args);else{if(!S[e.command])throw new Error("Unknown command: "+e.command);S[e.command].apply(S,e.args)}else e.init}}]);
//# sourceMappingURL=main.worker.js.map